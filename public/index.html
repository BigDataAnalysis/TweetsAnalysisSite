<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Bo's Tweets Facts!</title>
<link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
<link href="css/nav.css" rel="stylesheet" type="text/css" media="all"/>
<link rel="stylesheet" href="css/jquery-ui.css">
<script src="js/jquery-1.9.1.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/sprintf.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>

  </head>
  <script>
$(document).ready(function () {
});
</script>
  <body>

    <div class="main">  
      <div class="wrap">       
        <div class="column_left">            
          <div class="column_left_grid1">
            <div class="weather">
              <h3> Top 20 buzz words in the past 10 minutes</h3>
              <div class="temp_list">
                <ul id="rankingList">
                </ul>
              </div>
            </div>
          </div> 
        </div> 
        
        <div class="column_right">
          <div class="column_right_grid1">
            <div class="weather">
              <h3> Top 20 Big Data Influentials in Jan 2014</h3>
              <div class="temp_list">
                <ul id="influentialList">
                  <li><a href="https://twitter.com/search?q=%40DouglasBurson&src=typd"><span class="day_name">@DouglasBurson</span> <label class="digits changed">1164836</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40bill_nizzle&src=typd"><span class="day_name">@bill_nizzle</span> <label class="digits">355417</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40TechCrunch&src=typd"><span class="day_name">@TechCrunch</span> <label class="digits">4146</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40wtrsld&src=typd"><span class="day_name">@wtrsld</span> <label class="digits">2915</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40HarvardBiz&src=typd"><span class="day_name">@HarvardBiz</span> <label class="digits">2069</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40LowonganKerjaID&src=typd"><span class="day_name">@LowonganKerjaID</span> <label class="digits">1534</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40evgenymorozov&src=typd"><span class="day_name">@evgenymorozov</span> <label class="digits">1286</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40LovinZeva&src=typd"><span class="day_name">@LovinZeva</span> <label class="digits">1275</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40CloudExpo&src=typd"><span class="day_name">@CloudExpo</span> <label class="digits">1265</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40WorldBank&src=typd"><span class="day_name">@WorldBank</span> <label class="digits">1214</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40JacobShama&src=typd"><span class="day_name">@JacobShama</span> <label class="digits">1000</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40drcstewart66&src=typd"><span class="day_name">@drcstewart66</span> <label class="digits">933</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40ThingsExpo&src=typd"><span class="day_name">@ThingsExpo</span> <label class="digits">917</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40DARPA&src=typd"><span class="day_name">@DARPA</span> <label class="digits">876</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40CKsmiles1&src=typd"><span class="day_name">@CKsmiles1</span> <label class="digits">855</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40googleanalytics&src=typd"><span class="day_name">@googleanalytics</span> <label class="digits">840</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40paulapaul78&src=typd"><span class="day_name">@paulapaul78</span> <label class="digits">785</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40BigDataExpo&src=typd"><span class="day_name">@BigDataExpo</span> <label class="digits">768</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40JoshuaCentner&src=typd"><span class="day_name">@JoshuaCentner</span> <label class="digits">756</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40atakaws&src=typd"><span class="day_name">@atakaws</span> <label class="digits">741</label></a></li>


                </ul>
              </div>
            </div>
          </div>                   
           
        </div>
    
      </div>
    </div>   

      
  
  </body>

  <a href="https://github.com/BigDataAnalysis"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
  <script>
  start();
  function sort(newRankingList){
    var rankingList = $('#rankingList');
    var listitems = $('li', rankingList);

    //listitems.sort(function (a, b) {
    if (newRankingList === undefined){
      return;
    }
    newRankingList.sort(function (a, b) {
      var cnta = $(a).text().match(/mentions count (.*)/); 
      var cntb = $(b).text().match(/mentions count (.*)/); 

      return (parseInt(cnta[1]) > parseInt(cntb[1]));
    });
    rankingList.append(newRankingList);
  }

  function start(){

    var curTime = Date.now();
    var preTime = Date.now();

    var socket = io.connect('http://twitter-stat.herokuapp.com/');

    socket.on('connect', function(data){

      setStatus('connected');
      socket.emit('subscribe', {
        channel:'realtime'});
    });

    socket.on('reconnecting', function(data){

      setStatus('reconnecting');
    });

    socket.on('message', function (data) {

      console.log('received a message: ', data);
      addMessage(data);
      buildNewRankingList(data);
    });

  }

  function addMessage(data) {
    $('#online').html(data);
  }

  function setStatus(msg) {
    console.log('Connection Status : ' + msg);
  }

  function buildNewRankingList(data){
    var rankingList = $('#rankingList');
    


    //
    var master = [];

    // Identify the master values.
    rankingList.children('li').each(function(index,value) {
        master.push($(this).text());
    });

    rankingList.empty();
    
    var newRankingList = [];
    var rankings = JSON.parse(data);
    rankings.forEach(function(e, idx, arr){
      var hashTag = e['id'];
      var cnt = e['cnt'];
      var href = e['href'];
      var newLi = sprintf('<li><a href="%s"><span class="day_name">#%s</span> <label class="digits">%s</label></a></li>', href, hashTag, cnt);

      if (master[idx] != undefined) {
        var result = master[idx].split(/[#\s]+/);
        var oldHashtag = result[1];
        var oldCount = result[2];
        if (oldHashtag != hashTag){
          newLi = sprintf('<li><a href="%s"><span class="day_name goup">#%s</span> <label class="digits goup">%s</label></a></li>', href, hashTag, cnt);
        } else if (oldCount != cnt) {
          newLi = sprintf('<li><a href="%s"><span class="day_name">#%s</span> <label class="digits changed">%s</label></a></li>', href, hashTag, cnt); 
        }
      }
      newRankingList.push(newLi);
      rankingList.append(newLi);
    })

    //sort(newRankingList);
  }
  </script>

  </html>
