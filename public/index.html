<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Bo's Tweets Facts!</title>
<link href="css/style.css" rel="stylesheet" type="text/css" media="all"/>
<link href="css/nav.css" rel="stylesheet" type="text/css" media="all"/>
<link rel="stylesheet" href="css/jquery-ui.css">
<script src="js/jquery-1.9.1.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/sprintf.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>

  </head>
  <script>
$(document).ready(function () {
});


</script>
  <body>

    <div class="main">  
      <div class="wrap">       
        <div class="column_left">            
          <div class="column_left_grid1">
            <div class="weather">
              <h3> Top 20 buzz words in the past 10 minutes</h3>
              <div class="temp_list">
                <ul id="rankingList">
                </ul>
              </div>
            </div>
          </div> 
        </div> 
        
        <div class="column_right">
          <div class="column_right_grid1">
            <div class="weather">
              <div id="card">
              
              
              <div class="temp_list_back">
                <h3  id="flip2"> Big Data Influentials Network</h3>
  
              </div>
              <div class="temp_list">
                <h3  id="flip1"> Top 20 Big Data Influentials in Jan 2014</h3>
                <ul id="influentialList">
                  <li><a href="https://twitter.com/search?q=%40wtrsld&src=typd"><span class="day_name">@wtrsld</span> <label class="digits">2915</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40DouglasBurson&src=typd"><span class="day_name">@DouglasBurson</span> <label class="digits">1648</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40bill_nizzle&src=typd"><span class="day_name">@bill_nizzle</span> <label class="digits">683</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40LovinZeva&src=typd"><span class="day_name">@LovinZeva</span> <label class="digits">426</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40KPMG&src=typd"><span class="day_name">@KPMG</span> <label class="digits">379</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40WOWFakta&src=typd"><span class="day_name">@WOWFakta</span> <label class="digits">341</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40drcstewart66&src=typd"><span class="day_name">@drcstewart66</span> <label class="digits">312</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40twitterapi&src=typd"><span class="day_name">@twitterapi</span> <label class="digits">256</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40DamballaInc&src=typd"><span class="day_name">@DamballaInc</span> <label class="digits">240</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40DataIsFuture&src=typd"><span class="day_name">@DataIsFuture</span> <label class="digits">207</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40NetEvolution&src=typd"><span class="day_name">@NetEvolution</span> <label class="digits">196</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40danbarker&src=typd"><span class="day_name">@danbarker</span> <label class="digits">168</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40kdnuggets&src=typd"><span class="day_name">@kdnuggets</span> <label class="digits">152</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40HarvardBiz&src=typd"><span class="day_name">@HarvardBiz</span> <label class="digits">147</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40JohnDCook&src=typd"><span class="day_name">@JohnDCook</span> <label class="digits">132</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40googleanalytics&src=typd"><span class="day_name">@googleanalytics</span> <label class="digits">114</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40phippmar1&src=typd"><span class="day_name">@phippmar1</span> <label class="digits">102</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40CERN&src=typd"><span class="day_name">@CERN</span> <label class="digits">102</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40paul_irish&src=typd"><span class="day_name">@paul_irish</span> <label class="digits">101</label></a></li>
                  <li><a href="https://twitter.com/search?q=%40tkb&src=typd"><span class="day_name">@tkb</span> <label class="digits">96</label></a></li>
                </ul>
              </div>
            </div>
            </div>
          </div>                   
           
        </div>
    
      </div>
    </div>   

      
  
  </body>

  <a href="https://github.com/BigDataAnalysis"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://github-camo.global.ssl.fastly.net/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
  <script>

  $('#flip1').click(function (e) {
    var $card = $('#card');
    if ($card.hasClass("flipped")) {
        $card.removeClass('flipped');
        // $(this).removeClass('flipped');
    } else {
        $card.addClass('flipped');
         // $(this).addClass('flipped');
    }
  });

  $('#flip2').click(function (e) {
    var $card = $('#card');
    if ($card.hasClass("flipped")) {
        $card.removeClass('flipped');
        // $(this).removeClass('flipped');
    } else {
        $card.addClass('flipped');
         // $(this).addClass('flipped');
    }
  });


  var color = d3.scale.category20();

var width =  $(".temp_list_back").parent().width();
var height =  $(".temp_list_back").height();

var force = d3.layout.force()
    .charge(-120)
    .linkDistance(30)
    .size([width, height]);


var svg = d3.select(".temp_list_back").append("svg:svg")
    .attr("viewBox", "0 0 " + width*0.9 + " " + height);

d3.json("graph.json", function(error, graph) {
  force
      .nodes(graph.nodes)
      .links(graph.links)
      .start();

  var link = svg.selectAll(".link")
      .data(graph.links)
    .enter().append("line")
      .attr("class", "link")
      .style("stroke-width", function(d) { return Math.sqrt(d.value); });

  var node = svg.selectAll(".node")
      .data(graph.nodes)
    .enter().append("circle")
      .attr("class", "node")
      .attr("r", 5)
      .style("fill", function(d) { return color(d.group); })
      .call(force.drag);

  node.append("title")
      .text(function(d) { return d.name; });

  force.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  });
});








  start();
  function sort(newRankingList){
    var rankingList = $('#rankingList');
    var listitems = $('li', rankingList);

    //listitems.sort(function (a, b) {
    if (newRankingList === undefined){
      return;
    }
    newRankingList.sort(function (a, b) {
      var cnta = $(a).text().match(/mentions count (.*)/); 
      var cntb = $(b).text().match(/mentions count (.*)/); 

      return (parseInt(cnta[1]) > parseInt(cntb[1]));
    });
    rankingList.append(newRankingList);
  }

  function start(){

    var curTime = Date.now();
    var preTime = Date.now();

    var socket = io.connect('http://twitter-stat.herokuapp.com/');

    socket.on('connect', function(data){

      setStatus('connected');
      socket.emit('subscribe', {
        channel:'realtime'});
    });

    socket.on('reconnecting', function(data){

      setStatus('reconnecting');
    });

    socket.on('message', function (data) {

      console.log('received a message: ', data);
      addMessage(data);
      buildNewRankingList(data);
    });

  }

  function addMessage(data) {
    $('#online').html(data);
  }

  function setStatus(msg) {
    console.log('Connection Status : ' + msg);
  }

  function buildNewRankingList(data){
    var rankingList = $('#rankingList');
    


    //
    var master = [];

    // Identify the master values.
    rankingList.children('li').each(function(index,value) {
        master.push($(this).text());
    });

    rankingList.empty();
    
    var newRankingList = [];
    var rankings = JSON.parse(data);
    rankings.forEach(function(e, idx, arr){
      var hashTag = e['id'];
      var cnt = e['cnt'];
      var href = e['href'];
      var newLi = sprintf('<li><a href="%s"><span class="day_name">#%s</span> <label class="digits">%s</label></a></li>', href, hashTag, cnt);

      if (master[idx] != undefined) {
        var result = master[idx].split(/[#\s]+/);
        var oldHashtag = result[1];
        var oldCount = result[2];
        if (oldHashtag != hashTag){
          newLi = sprintf('<li><a href="%s"><span class="day_name goup">#%s</span> <label class="digits goup">%s</label></a></li>', href, hashTag, cnt);
        } else if (oldCount != cnt) {
          newLi = sprintf('<li><a href="%s"><span class="day_name">#%s</span> <label class="digits changed">%s</label></a></li>', href, hashTag, cnt); 
        }
      }
      newRankingList.push(newLi);
      rankingList.append(newLi);
    })

    //sort(newRankingList);
  }
  </script>

  </html>
